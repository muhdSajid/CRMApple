# Password Reset Feature Implementation

## Overview

Added password reset functionality to the User Management page, allowing administrators to reset user passwords. The new password is automatically generated by the backend and displayed to the admin.

## Implementation Details

### 1. Redux Store Enhancement (`src/store/usersSlice.js`)

Added new async thunk for password reset:

```javascript
export const resetUserPassword = createAsyncThunk(
  "users/resetUserPassword",
  async (userId, { rejectWithValue }) => {
    try {
      console.log("Resetting password for user:", userId);
      const response = await api.post(`/auth/reset/${userId}`);
      console.log("Password reset response:", response.data);
      return response.data;
    } catch (error) {
      console.error("Error resetting password:", error);
      const message =
        error.response?.data?.message ||
        error.message ||
        "Failed to reset password";
      return rejectWithValue(message);
    }
  }
);
```

**State Management:**

- Added `resetPassword` field to store the new password returned from API
- Proper loading, success, and error state handling
- Automatic state cleanup on modal close

### 2. API Endpoint

**Endpoint:** `POST /api/auth/reset/{userId}`

**Authentication:** Uses Bearer token from existing authentication mechanism (automatically added via axios interceptors)

**Expected Response:**

```json
{
  "message": "Password reset successfully!",
  "newPassword": "aB3$dEf7Gh"
}
```

**Note:** The application is configured to proxy requests to `http://localhost:8081`. If your backend runs on port 8080, update the proxy configuration in `vite.config.js`:

```javascript
proxy: {
  '/api': {
    target: 'http://localhost:8080',  // Change from 8081 to 8080
    changeOrigin: true,
    secure: false,
  },
}
```

### 3. User Management Component (`src/components/usermanagment/UserManagment.jsx`)

**Added Features:**

#### Reset Password Button

- Added to each user row in the Actions column
- Orange-colored icon with key symbol
- Protected by privilege guard (requires `user.update`, `user.*`, or `*` privilege)
- Confirmation dialog before reset

```jsx
<button
  onClick={() => handleResetPassword(user)}
  disabled={isLoading}
  className="group relative flex items-center justify-center w-8 h-8 text-orange-600 hover:text-white bg-orange-50 hover:bg-orange-600 border border-orange-200 hover:border-orange-600 rounded-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
  title="Reset Password"
>
  <svg
    className="w-4 h-4"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"
  >
    <path
      strokeLinecap="round"
      strokeLinejoin="round"
      strokeWidth={2}
      d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"
    />
  </svg>
</button>
```

#### Reset Password Handler

```javascript
const handleResetPassword = (user) => {
  console.log("Reset password clicked for user:", user);
  if (
    window.confirm(
      `Are you sure you want to reset the password for ${user.firstName} ${user.lastName}?`
    )
  ) {
    dispatch(resetUserPassword(user.id));
  }
};
```

#### New Password Display Modal

- Beautiful modal that displays the generated password
- Copy to clipboard functionality
- Warning message about secure password sharing
- Similar design to the existing temporary password modal

### 4. Security Features

**Privilege-Based Access:**

- Reset password button only visible to users with proper privileges:
  - `user.update`
  - `user.*`
  - `*` (superadmin)

**Confirmation Dialog:**

- Users must confirm before resetting password
- Shows user's full name in confirmation message

**Secure Token Handling:**

- Uses existing authentication mechanism
- Bearer token automatically added via axios interceptors
- Token validation and error handling

### 5. User Experience Flow

1. **Admin clicks Reset Password button**

   - Confirmation dialog appears
   - Shows user's full name for verification

2. **Admin confirms reset**

   - Loading state displayed
   - API call made to backend

3. **Success response**

   - Modal displays the new password
   - Copy to clipboard button available
   - Warning message about secure sharing

4. **Admin shares password**
   - Copy password to clipboard
   - Close modal
   - User can login with new password

## UI Components

### Actions Column Layout

```
View (Blue) | Edit (Green) | Reset Password (Orange)
```

### Reset Password Modal Features

- ‚úÖ Success icon with green background
- üìã Password field with copy button
- ‚ö†Ô∏è Security warning message
- üîò Close button to dismiss

## Testing

### Test Scenarios

1. **Normal Reset Flow**

   - Click reset button for a user
   - Confirm the action
   - Verify modal displays with new password
   - Copy password to clipboard
   - Close modal

2. **Error Handling**

   - Backend unavailable ‚Üí Error toast displayed
   - Invalid user ID ‚Üí Error toast displayed
   - Network error ‚Üí Error toast displayed

3. **Privilege Checks**

   - Users without `user.update` privilege ‚Üí Button hidden
   - Users with privilege ‚Üí Button visible and functional

4. **Cancel Action**
   - Click reset button
   - Click "Cancel" in confirmation ‚Üí No API call made

## Files Modified

1. **src/store/usersSlice.js**

   - Added `resetUserPassword` async thunk
   - Added `resetPassword` state field
   - Added reducer cases for reset password actions

2. **src/components/usermanagment/UserManagment.jsx**
   - Added reset password button in actions column
   - Added `handleResetPassword` function
   - Added `handleCloseResetPasswordModal` function
   - Added reset password modal component
   - Updated imports and state management

## API Integration

### Authentication Headers

All requests automatically include:

- `Authorization: Bearer {token}` - JWT token from login
- `user_id: {userId}` - Current user's ID (from axios interceptor)

### Error Responses

The implementation handles:

- **401 Unauthorized** - Token expired or invalid
- **403 Forbidden** - Insufficient permissions
- **404 Not Found** - User not found
- **500 Server Error** - Backend error

## Next Steps

Consider implementing:

1. **Password History** - Prevent reuse of recent passwords
2. **Email Notification** - Send password reset email to user
3. **Temporary Password Expiry** - Force password change on first login
4. **Audit Log** - Track who reset which user's password
5. **Bulk Password Reset** - Reset passwords for multiple users

## Configuration Notes

- Backend should be running on port configured in `vite.config.js` (default: 8081)
- CORS should allow requests from `http://localhost:5174`
- JWT token expiration is handled automatically
- All API calls use the same authentication mechanism as other services

## Support

For issues or questions:

- Check browser console for detailed API logs
- Verify backend is running and accessible
- Ensure user has proper privileges
- Check network tab for API request/response details
